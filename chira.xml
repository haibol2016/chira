<tool id="chira" name="ChiRA" version="1.0">
    <description>Chimeric Read Annotator</description>
    <requirements>
        <requirement type="package" version="0.8.3">pysam</requirement>
        <requirement type="package" version="2.24">bedtools</requirement>
        <requirement type="package" version="2.2.6">bowtie2</requirement>
    </requirements>

    <command><![CDATA[
        python chira.py 
        -i "$input" 
        -s "$type" 
        -m "$min_looplen" 
        -tc "$tpm_cutoff" 
        -sc "score_cutoff" 
        -mo "$merge_overlap" 
        -cs "$crg_share" 
        -e "$em_threshold" 
        -so "$suboptimal" 
        "$hybridize" 
        -p "\${GALAXY_SLOTS:-1}"
        -o "$chira_out"

    ]]></command>

    <inputs>
        <param format="fasta,fastq" name="input" type="data" label="Input file"
               help="Input fasta/fastq file"/>

        <param name="type" type="select" label="Map reads to">
            <option value="fw">Transcript strand only</option>
            <option value="rc">Reverse compliment of transcript strand only</option>
            <option value="both">Try both strands</option>
        </param>

        <param name="min_looplen" type="integer" value="3" label="Minimum loop length"
               help="Set minimum loop length in case of single RNA duplex"/>

        <param name="tpm_cutoff" type="float" value="0.1" label="TPM cut-off" min="0" max="1"
               help="Transcripts with less than this percentile TPMs will be discarded in the final output. [0-1.0]"/>

        <param name="score_cutoff" type="float" value="0.1" label="Score cut-off" min="0" max="1"
               help="Hybrids with less than this score will be discarded in the final output. [0-1.0]"/>

        <param name="merge_overlap" type="float" value="0.7" label="Percent overlap for merging" min="0" max="1"
               help="Minimum percentage overlap among BED entries inorder to merge. [0-1.0]"/>

        <param name="crg_share" type="float" value="0.7" label="CRG share" min="0" max="1"
               help="Minimum percentage overlap of a locus on a CRG inorder to merge it into a CRG. [0-1.0]"/>

        <param name="em_threshold" type="float" value="0.01" label="EM convergence threshold" min="0" max="1"
               help="The maximum difference of transcripts expression between two consecutive iterations
               of EM algorithm to converge."/>

        <param name="suboptimal" type="float" value="0.7" label="Suboptimal hybrids length" min="0" max="1"
               help="In case of multimappings, hybrids with total alignment length greater than this % of the
               longest hybrid are considered."/>

        <param name="hybridize" type="boolean" truevalue="--hybridize" falsevalue="" checked="false"
            label="Hybridize the predicted chimeras" help="It may take signifincantly long time to hybridize all
            chimeras. Please consider using a high score cut-off and Suboptimal hybrid length options along with this." />

    </inputs>

    <outputs>
        <data format="tabular" name="chira_out" label="ChiRA result file on ${on_string}"/>
    </outputs>

    <help>

.. class:: infomark

**What it does** 

Estimate variance-mean dependence in count data from high-throughput sequencing assays and test for differential expression based on a model using the negative binomial distribution


**Inputs**

ChiRA_ requires a fasta or fastq file as input



**Output**

ChiRA_ generates a tabular file containing the different columns.

====== ==========================================================
Column Description
------ ----------------------------------------------------------
     1 Gene Identifiers
     2 mean normalised counts, averaged over all samples from both conditions
     3 the logarithm (to basis 2) of the fold change
     4 standard error estimate for the log2 fold change estimate
     5 p value for the statistical significance of this change
     6 p value adjusted for multiple testing with the Benjamini-Hochberg procedure
       which controls false discovery rate (FDR)
====== ==========================================================


.. _DESeq2: http://master.bioconductor.org/packages/release/bioc/html/DESeq2.html


    </help>
    <citations>
        <citation type="doi">http://dx.doi.org/10.1101/002832</citation>
    </citations>
</tool>
